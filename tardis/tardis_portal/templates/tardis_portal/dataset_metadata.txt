{% load linkify_pubid %}Dataset {{ dataset }}

{% if doi %}Please cite as:
{% for author in doi_exp.author_experiment_set.all %}{%if not forloop.first%}; {%endif%}{{author.author}}{% endfor %} ({{ doi_exp.publication_year }}): {{ dataset.description }}. {{ site_longtitle }}. Dataset. http://dx.doi.org/{{doi}}{% endif %}

{% if dataset.experiment.license %}This dataset and metadata is licensed under a {{ dataset.experiment.license }} licence ({{dataset.experiment.license.url}}){% endif %}

Analysed using: {{ dataset.analysis.package }} version {{ dataset.analysis.package_ver }}

----

{{ dataset.analysis.processing_set.count }} pipeline{{ dataset.analysis.processing_set.count|pluralize }} in this dataset: {% for i in dataset.analysis.processing_set.all %}{% if not forloop.first %}; {% endif %}{{i.id}}{%endfor%}
{% for i in dataset.analysis.processing_set.all %}
# {{ i.id }}

From source: {{ i.sequence.library.extract.sample.source }}, sample {{ i.sequence.library.extract.sample }}

Extraction: {{ i.sequence.library.extract.protocol_note }} ({% filter linkify_pubid|striptags %}{{ i.sequence.library.extract.protocol_ref}}{% endfilter %})

## Library
Type of material: {{ i.sequence.library.get_source_display }}
Layout: {{ i.sequence.library.get_layout_display }}
Construction: {{ i.sequence.library.protocol_note }} ({%filter striptags%}{% filter linkify_pubid %}{{ i.sequence.library.protocol_ref }}{% endfilter %}{%endfilter%})
{% if i.sequence.library.repair_method %}Repair method: {{ i.sequence.library.repair_method }}{% endif %}
{% if i.sequence.library.enrich_method %}Enrich method: {{ i.sequence.library.enrich_method }}{%endif%}
{% if i.sequence.library.enrich_target %}Enrich target: {{i.sequence.library.get_enrich_target_display}}{%endif%}
{% if i.sequence.library.amp_method %}Target amplified using: {{ i.sequence.library.amp_method }}{% endif %}

## Sequence
Sequencing method: {{ i.sequence.method }} ({{ i.sequence.get_method_display }})
Sequencer used: {{ i.sequence.tech }} (chemistry version {{i.sequence.tech_chem}})
Sequencing options: {{ i.sequence.tech_options }}
{% if i.sequence.demulti_prog %}Demultiplexed using: {{ i.sequence.demulti_prog }} version {{ i.sequence.demulti_prog_ver }} with options {{ i.sequence.demulti_prog_opt }}{%endif%}
{% if i.sequence.error_rate %}Estimated error rate: 1 x 10^{{i.sequence.error_rate}}{% endif %}
{% if i.sequence.error_method %}Error rate estimated using: {{ i.sequence.error_method}}{% endif %}

## Processing
Processed using: {{ i.package }} version {{ i.package_ver }}
Aligned to: {{ i.reference }}
{% if i.fold_coverage %}Average fold coverage: {{ i.fold_coverage}}x{%endif%}
{% if i.percent_coverage %}Percentage coverage: {{ i.percent_coverage }}{%endif%}
{% if i.contigs %}Number of contigs: {{ i.contigs }}{%endif%}
{% endfor %}

----

{{ sources.count }} source{{ sources.count|pluralize }} in this dataset: {% for source in sources %}{% if not forloop.first %}; {% endif %}{{ source }}{%endfor%}

{% for source in sources %}
# {{ source }}

Source ID: {{ source.id }}
Collection date: {{ source.date|date:"c"}}
Organism: {{ source.organism }} (NCBI taxonomy ID {{ source.organism.id }})
Source details: {{ source.source_details }}
Gender: {{ source.get_gender_display }}
Age: {{ source.get_age_cat_display }}
Age range: {% if source.age_range %}{{ source.age_range }}{% endif %}

Continent: {{ source.get_geoloc_continent_display }}
Country: {{ source.geoloc_country }}
Locale: {{ source.geoloc_locale }}
{%if source.geoloc_lat or source.geoloc_lon %}Lat/lon: {{source.geoloc_lat}}, {{source.geoloc_lon}}{%endif%}
Biome: {{ source.env_biome }}
Env feature: {{ source.env_feature }}
{% if source.carbondate_id %}Carbon date: {{ source.carbondate_id }} {{ source.carbondate_years }} Â± {{ source.carbondate_error }}{% endif %}

{% for sample in samples %}{% if sample in source.sample_set.all %}## {{ sample }}

Collection date: {{ sample.date|date:"c" }}
Sample category: {{ sample.get_sample_cat_display }}
Sample details: {{ sample.sample_details }}
Environmental package: {{ sample.get_env_package_display }}
{% endif %}{% endfor %}
{% endfor %}
