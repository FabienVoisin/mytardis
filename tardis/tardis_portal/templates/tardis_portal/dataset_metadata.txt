{% load linkify_pubid %}
Dataset {{ dataset }}

{% if doi %}Please cite as:
{%filter striptags%}{% include "tardis_portal/doi/citation.html" with rtype="Dataset" %}{%endfilter%}{% endif %}

{% if dataset.experiment.license %}This dataset and metadata is licensed under a {{ dataset.experiment.license }} licence ({{dataset.experiment.license.url}}){% endif %}

{{ dataset.analysis.processing_set.count }} pipeline{{ dataset.analysis.processing_set.count|pluralize }} in this dataset: {% for i in dataset.analysis.processing_set.all %}{% if not forloop.first %}, {% endif %}{{i.id}}{%endfor%}
{% for i in dataset.analysis.processing_set.all %}

# {{ i.id }}

From source: {{ i.sequence.library.extract.sample.source }}, sample {{ i.sequence.library.extract.sample }}

Extraction: {{ i.sequence.library.extract.protocol_note }} ({% filter linkify_pubid|striptags %}{{ i.sequence.library.extract.protocol_ref}}{% endfilter %})

## Library
Type of material: {{ i.sequence.library.get_source_display }}
Layout: {{ i.sequence.library.get_layout_display }}
Construction: {{ i.sequence.library.protocol_note }} ({%filter striptags%}{% filter linkify_pubid %}{{ i.sequence.library.protocol_ref }}{% endfilter %}{%endfilter%})
{% if i.sequence.library.repair_method %}Repair method: {{ i.sequence.library.repair_method }}{% endif %}
{% if i.sequence.library.enrich_method %}Enrich method: {{ i.sequence.library.enrich_method }}{%endif%}
{% if i.sequence.library.enrich_target %}Enrich target: {{i.sequence.library.get_enrich_target_display}}{%endif%}
{% if i.sequence.library.amp_method %}Target amplified using: {{ i.sequence.library.amp_method }}{% endif %}

## Sequence
Sequencing method: {{ i.sequence.method }} ({{ i.sequence.get_method_display }})
Sequencer used: {{ i.sequence.tech }} (chemistry version {{i.sequence.tech_chem}})
Sequencing options: {{ i.sequence.tech_options }}
{% if i.sequence.demulti_prog %}Demultiplexed using: {{ i.sequence.demulti_prog }} version {{ i.sequence.demulti_prog_ver }} with options {{ i.sequence.demulti_prog_opt }}{%endif%}
{% if i.sequence.error_rate %}Estimated error rate: 1 x 10^{{i.sequence.error_rate}}{% endif %}
{% if i.sequence.error_method %}Error rate estimated using: {{ i.sequence.error_method}}{% endif %}

## Processing
Processed using: {{ i.package }} version {{ i.package_ver }}
Aligned to: {{ i.reference }}
{% if i.fold_coverage %}Average fold coverage: {{ i.fold_coverage}}x{%endif%}
{% if i.percent_coverage %}Percentage coverage: {{ i.percent_coverage }}{%endif%}
{% if i.contigs %}Number of contigs: {{ i.contigs }}{%endif%}
{% endfor %}

Analysed using: {{ dataset.analysis.package }} version {{ dataset.analysis.package_ver }}
